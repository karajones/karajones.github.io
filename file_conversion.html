<!DOCTYPE html>
<html>
	<head>
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<meta charset="utf-8" />
		<title>File conversion</title>
	</head>
<body>
<h3>File conversion</h3>

<h4>Admixture: ipyrad vcf to plink bed</h4>

<p>Programs you will need:</p>

<ul>
	<li><a href="https://vcftools.github.io/index.html" title="vcftools">vcftools</a></li>
	<li><a href="https://www.cog-genomics.org/plink2" title="plink 1.9">plink 1.9</a></li>
</ul>

<p>VCF files output by ipyrad contain all the SNPs found at each locus. But for Admixture, you need unlinked SNPs (i.e. only one SNP per locus). To make sure that the SNPs in your final file are unlinked, you will need to <code>thin</code> the SNPs to the length of your sequence reads using vcftools. For example, if you are using 150 bp single-end reads, then you would use <code>--thin 150</code>. For 100 bp paired-end reads, you would use <code>--thin 200</code>.</p>

<p>The following code will input a file called <code>test.vcf</code> containing SNPs from sequences with 150 bp single-end reads and output a file called <code>test.recode.vcf</code>:</p>

<pre><code>vcftools --vcf test.vcf --recode --thin 150 --out test  
</code></pre>

VCFtools - v0.1.14
(C) Adam Auton and Anthony Marcketta 2009

<pre>
Parameters as interpreted:
	--vcf test.vcf
	--thin 150
	--out test
	--recode

After filtering, kept 27 out of 27 Individuals
Outputting VCF file...
After filtering, kept 505 out of a possible 5512 Sites
Run Time = 0.00 seconds
</pre>

<p>Next, convert the vcf to a plink ped format in vcftools<sup><a id="ffn1" href="#fn1" class="footnote">1</a></sup>. Since ipyrad using locus numbers instead of chromosomes, all the locus numbers will be replaced with zeros. The program will then output two files: <code>test.ped</code> and <code>test.map</code>.</p>

<pre><code>vcftools --vcf test.recode.vcf --out test --plink
</code></pre>

<pre>
VCFtools - v0.1.14
(C) Adam Auton and Anthony Marcketta 2009

Parameters as interpreted:
	--vcf test.recode.vcf
	--out test
	--plink

After filtering, kept 27 out of 27 Individuals
Writing PLINK PED and MAP files ... 

Unrecognized values used for CHROM: locus_462 - Replacing with 0.
Unrecognized values used for CHROM: locus_1020 - Replacing with 0.
...
Unrecognized values used for CHROM: locus_173973 - Replacing with 0.
Done.
After filtering, kept 505 out of a possible 505 Sites
Run Time = 0.00 seconds
</pre>
    
<p>Finally, convert the <code>ped</code> file to a <code>bed</code> file:</p>

<pre><code>plink --file test --make-bed --allow-extra-chr 0 --out test
</code></pre>

<pre>
PLINK v1.90b3.30 64-bit (27 Jan 2016)      https://www.cog-genomics.org/plink2
(C) 2005-2016 Shaun Purcell, Christopher Chang   GNU General Public License v3
Logging to test.log.
Options in effect:
  --allow-extra-chr 0
  --file test
  --make-bed
  --out test

8192 MB RAM detected; reserving 4096 MB for main workspace.
.ped scan complete (for binary autoconversion).
Performing single-pass .bed write (494 variants, 27 people).
--file: test-temporary.bed + test-temporary.bim + test-temporary.fam written.
494 variants loaded from .bim file.
27 people (0 males, 0 females, 27 ambiguous) loaded from .fam.
Ambiguous sex IDs written to test.nosex .
Using 1 thread (no multithreaded calculations invoked.
Before main variant filters, 27 founders and 0 nonfounders present.
Calculating allele frequencies... done.
Total genotyping rate is 0.98703.
494 variants and 27 people pass filters and QC.
Note: No phenotypes present.
--make-bed to test.bed + test.bim + test.fam ... done.
</pre>

<p>You will need to following three files to run Admixture: <code>test.bed</code>, <code>test.bim</code> and <code>test.fam</code>.</p>

<ol id="footnotes">
	<li id="fn1">If you are using pyrad, rather than ipyrad, then this next step will need to be altered. Open test.recode.vcf in a text editor and change all of values in the first column to be 0. (You can do this easily by copy and pasting the file into Excel.) Then run: <code>plink --file test --make-bed --allow-extra-chr 0 --out test</code> <a href="#ffn1">&#x21A9;&#xFE0E;</a></li>
</ol></body>
</html>

